---

id: 581
datetime: 2016-05-08 03:07:31 +0000 UTC
title: "Tuna Please!"
draft: false


---

So I had a moment a few weeks ago at work where we were trying to decide if a service was actually running on a machine. We had gotten to the point where we had actually ssh'd into the production machine, and were poking around trying to figure out what was up.

My coworker Fisher was driving, and I suggested he run `nmap` on the box to see what ports were open. He ran it, but then as soon as the results came back, he started running another command. As he typed, he said, quite loudly, "Tuna Please!", and then ran the command `sudo netstat tunapl`.

It outputs something like the following (truncated for brevity):

```shell
$ sudo netstat tunapl
Active Internet connections (w/o servers)
Proto Recv-Q Send-Q Local Address           Foreign Address         State
tcp        0      0 192.168.1.18:ssh        125.88.177.98:30335     ESTABLISHED
tcp        0    160 192.168.1.18:ssh        cpe-72-231-30-23.:54860 ESTABLISHED
Active UNIX domain sockets (w/o servers)
Proto RefCnt Flags       Type       State         I-Node   Path
unix  2      [ ]         DGRAM                    4002     /run/systemd/notify
unix  2      [ ]         DGRAM                    9127     /run/user/109/systemd/notify
unix  2      [ ]         DGRAM                    4020     /run/systemd/shutdownd
unix  11     [ ]         DGRAM                    4022     /run/systemd/journal/dev-log
unix  2      [ ]         DGRAM                    1890496  /run/user/1001/systemd/notify
unix  7      [ ]         DGRAM                    4032     /run/systemd/journal/socket
unix  2      [ ]         DGRAM                    4571     /run/systemd/journal/syslog
...
```

I had never seen this combo before, but it was an outage, so I completely forgot about it. 

Then last week, I was like "oh yeah, Fisher used tuna please to figure this out". So I ran the command `sudo netstat tunaplz`. It gave me the data I wanted, so I decided to go read the man page for the flags to see what it was doing. The following is what I gleaned from that page:

 > `--tcp, -t` TCP sockets

 > `--udp, -u` UDP sockets

Both make sense, I want both types of connections.

 > `--numeric, -n` Show numerical addresses instead of trying to determine symbolic host, port or user names.

I guess that's helpful.

 > `-a, --all` Show both listening and non-listening sockets.

Cool, I want all the things.

 > `--program, -p` Show the PID and name of the program to which each socket belongs.

Yeah, this is what I wanted to know in the first place!

 > `--listening, -l` Only show listening sockets.

Wait, why this and `-a`? Oh well.

The great part about this, and the amazing discovery, is that `-z`, AFAICT, is not a valid flag, but `netstat` just ignores it, instead of complaining!

So, if you're on a Linux box, and you wanna know about some sockets, just ask your computer for some Tuna Please!

`sudo netstat tunaplz` !!!

/Nat

**Update**: As @saltyhorse [pointed out](https://twitter.com/saltyhorse/status/729296565983121409), this is all dependent on versions and operating systems and what not. This has been tested in a few places, but specifically was written about a Debian install on a Raspberry Pi B+.

```shell
$ netstat --version
net-tools 1.60
netstat 1.42 (2001-04-15)
Fred Baumgarten, Alan Cox, Bernd Eckenfels, Phil Blundell, Tuan Hoang and others
+NEW_ADDRT +RTF_IRTT +RTF_REJECT +FW_MASQUERADE +I18N
AF: (inet) +UNIX +INET +INET6 +IPX +AX25 +NETROM +X25 +ATALK +ECONET +ROSE
HW:  +ETHER +ARC +SLIP +PPP +TUNNEL -TR +AX25 +NETROM +X25 +FR +ROSE +ASH +SIT +FDDI +HIPPI +HDLC/LAPB +EUI64

$ uname -a
Linux newyork 4.1.13+ #826 PREEMPT Fri Nov 13 20:13:22 GMT 2015 armv6l GNU/Linux
```
